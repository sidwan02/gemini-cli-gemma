{"id":"fbf4304e-e655-4602-b377-6ac83214f1e3########3-build_and_test_agent-1l2rhx#0-0","name":"run_shell_command","response":{"output":"Command: npm run test\nDirectory: (root)\nOutput: ]\nNumber of calls: 1\n× SubagentInvocation > execute > should stream THOUGHT_CHUNK activities from the executor 1ms\n→ expected \"spy\" to be called with arguments: [ 'Subagent starting...\n' ]\nReceived:\n1st spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_START::{\\\"agentName\\\":\\\"MockAgent\\\",\\\"inputs\\\":{\\\"task\\\":\\\"Execute task\\\"}}\",\n]\n2nd spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_THOUGHT::{\\\"thought\\\":\\\"Analyzing...\\\"}\",\n]\n3rd spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_THOUGHT::{\\\"thought\\\":\\\" Still thinking.\\\"}\",\n]\nNumber of calls: 3\n× SubagentInvocation > execute > should NOT stream other activities (e.g., TOOL_CALL_START, ERROR) 0ms\n→ expected \"spy\" to be called 1 times, but got 3 times\n✓ SubagentInvocation > execute > should run successfully without an updateOutput callback 0ms\n✓ SubagentInvocation > execute > should handle executor run failure 0ms\n✓ SubagentInvocation > execute > should handle executor creation failure 0ms\n✓ SubagentInvocation > execute > should handle abortion signal during execution 1ms\n❯ src/tools/shell.test.ts (26 tests | 1 failed | 1 skipped) 193ms\n✓ ShellTool > isCommandAllowed > should allow a command if no restrictions are provided 13ms\n✓ ShellTool > isCommandAllowed > should allow a command with command substitution using $() 2ms\n✓ ShellTool > build > should return an invocation for a valid command 28ms\n✓ ShellTool > build > should throw an error for an empty command 3ms\n✓ ShellTool > build > should return an invocation for a valid relative directory path 2ms\n✓ ShellTool > build > should throw an error for a directory outside the workspace 2ms\n✓ ShellTool > build > should return an invocation for a valid absolute directory path 22ms\n✓ ShellTool > execute > should wrap command on linux and parse pgrep output 22ms\n✓ ShellTool > execute > should use the provided absolute directory as cwd 4ms\n✓ ShellTool > execute > should use the provided relative directory as cwd 5ms\n↓ ShellTool > execute > should not wrap command on windows\n✓ ShellTool > execute > should format error messages correctly 2ms\n✓ ShellTool > execute > should return a SHELL_EXECUTE_ERROR for a command failure 3ms\n✓ ShellTool > execute > should throw an error for invalid parameters 2ms\n× ShellTool > execute > should summarize output when configured 6ms\n→ expected \"summarizeToolOutput\" to be called with arguments: [ { …(11) }, …(4) ]\nNumber of calls: 0\n✓ ShellTool > execute > should clean up the temp file on synchronous execution error 2ms\n✓ ShellTool > execute > Streaming to `updateOutput` > should immediately show binary detection message and throttle progress 3ms\n✓ ShellTool > shouldConfirmExecute > should request confirmation for a new command and allowlist it on \"Always\" 3ms\n✓ ShellTool > shouldConfirmExecute > should throw an error if validation fails 2ms\n✓ ShellTool > shouldConfirmExecute > in non-interactive mode > should not throw an error or block for an allowed command 2ms\n✓ ShellTool > shouldConfirmExecute > in non-interactive mode > should not throw an error or block for an allowed command with arguments 2ms\n✓ ShellTool > shouldConfirmExecute > in non-interactive mode > should throw an error for command that is not allowed 2ms\n✓ ShellTool > shouldConfirmExecute > in non-interactive mode > should throw an error for a command that is a prefix of an allowed command 2ms\n✓ ShellTool > shouldConfirmExecute > in non-interactive mode > should require all segments of a chained command to be allowlisted 16ms\n✓ ShellTool > getDescription > should return the windows description when on windows 3ms\n✓ ShellTool > getDescription > should return the non-windows description when not on windows 1ms\n✓ src/services/shellExecutionService.test.ts (44 tests | 1 skipped) 317ms\n✓ src/tools/read-many-files.test.ts (31 tests) 309ms\n(node:55891) MaxListenersExceededWarning: Possible EventTarget memory leak detected. 11 abort listeners added to [AbortSignal]. MaxListeners is 10. Use events.setMaxListeners() to increase limit\n(Use `node --trace-warnings ...` to show where the warning was created)\n✓ src/tools/mcp-client.test.ts (32 tests) 380ms\n✓ connectToMcpServer with OAuth > should discover oauth config if not in www-authenticate header 354ms\n✓ src/utils/filesearch/fileSearch.test.ts (27 tests) 155ms\n✓ src/core/coreToolScheduler.test.ts (34 tests) 334ms\n✓ src/tools/edit.test.ts (56 tests) 190ms\n✓ src/core/logger.test.ts (39 tests) 253ms\n✓ src/utils/gitIgnoreParser.test.ts (25 tests) 102ms\n✓ src/utils/memoryDiscovery.test.ts (28 tests) 235ms\n✓ src/utils/fileUtils.test.ts (71 tests) 115ms\n✓ src/tools/glob.test.ts (37 tests) 2012ms\n✓ src/core/client.test.ts (52 tests | 1 skipped) 196ms\n✓ src/tools/web-search.test.ts (9 tests) 41ms\n✓ src/mcp/oauth-provider.test.ts (34 tests) 1227ms\n✓ MCPOAuthProvider > authenticate > should handle invalid callback request 1002ms\n✓ src/tools/smart-edit.test.ts (24 tests) 130ms\n✓ src/tools/write-file.test.ts (31 tests) 165ms\n✓ src/policy/config.test.ts (19 tests) 248ms\n✓ src/services/modelConfigService.test.ts (18 tests) 5ms\n✓ src/telemetry/sdk.test.ts (9 tests) 28ms\n✓ src/code_assist/oauth2.test.ts (25 tests) 83ms\n✓ src/utils/getFolderStructure.test.ts (15 tests) 84ms\n✓ src/tools/read-file.test.ts (29 tests) 170ms\n✓ src/hooks/hookRunner.test.ts (17 tests) 487ms\n✓ src/services/gitService.test.ts (14 tests) 79ms\n✓ src/config/config.test.ts (103 tests) 54ms\n✓ src/tools/ls.test.ts (21 tests) 161ms\n✓ src/services/fileDiscoveryService.test.ts (20 tests) 90ms\n✓ src/mcp/token-storage/keychain-token-storage.test.ts (29 tests) 102ms\n✓ src/utils/schemaValidator.test.ts (7 tests) 70ms\n✓ src/telemetry/loggers.test.ts (31 tests) 71ms\n✓ src/utils/workspaceContext.test.ts (34 tests) 41ms\n✓ src/utils/bfsFileSearch.test.ts (11 tests) 112ms\n✓ src/services/loopDetectionService.test.ts (47 tests) 483ms\n✓ LoopDetectionService > Content Loop Detection > should not detect a loop for random content 385ms\n✓ src/utils/editCorrector.test.ts (40 tests) 17ms\n✓ src/tools/mcp-tool.test.ts (42 tests) 119ms\n✓ src/utils/filesearch/crawler.test.ts (18 tests) 232ms\n✓ src/telemetry/metrics.test.ts (65 tests) 4281ms\n✓ src/utils/userAccountManager.test.ts (23 tests) 72ms\n✓ src/utils/memoryImportProcessor.test.ts (25 tests) 25ms\n✓ src/utils/terminalSerializer.test.ts (16 tests) 56ms\n✓ src/utils/filesearch/ignore.test.ts (12 tests) 37ms\n✓ src/tools/write-todos.test.ts (9 tests) 26ms\n✓ src/utils/pathReader.test.ts (18 tests) 60ms\n✓ src/tools/modifiable-tool.test.ts (12 tests) 53ms\n✓ src/tools/web-fetch.test.ts (32 tests) 65ms\n✓ src/telemetry/gcp-exporters.test.ts (18 tests) 40ms\n✓ src/utils/errorReporting.test.ts (6 tests) 25ms\n❯ src/agents/executor.test.ts (32 tests | 26 failed) 5100ms\n✓ AgentExecutor > create (Initialization and Validation) > should create successfully with allowed tools 7ms\n✓ AgentExecutor > create (Initialization and Validation) > SECURITY: should throw if a tool is not on the non-interactive allowlist 1ms\n✓ AgentExecutor > create (Initialization and Validation) > should create an isolated ToolRegistry for the agent 2ms\n✓ AgentExecutor > create (Initialization and Validation) > should use parentPromptId from context to create agentId 1ms\n× AgentExecutor > create (Initialization and Validation) > should correctly apply templates to initialMessages 27ms\n→ Unsupported chat object type\n✓ AgentExecutor > run (Execution Loop and Logic) > should log AgentFinish with error if run throws 2ms\n× AgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task with output (Happy Path with Output) 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task without output (Happy Path No Output) 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Execution Loop and Logic) > should error immediately if the model stops tools without calling complete_task (Protocol Violation) 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Execution Loop and Logic) > should report an error if complete_task is called with missing required arguments 1ms\n→ Unsupported chat object type\n× AgentExecutor > run (Execution Loop and Logic) > should handle multiple calls to complete_task in the same turn (accept first, block rest) 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Execution Loop and Logic) > should execute parallel tool calls and then complete 5004ms\n→ Test timed out in 5000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\n× AgentExecutor > run (Execution Loop and Logic) > SECURITY: should block unauthorized tools and provide explicit failure to model 9ms\n→ Unsupported chat object type\n× AgentExecutor > Edge Cases and Error Handling > should report an error if complete_task output fails schema validation 2ms\n→ Unsupported chat object type\n✓ AgentExecutor > Edge Cases and Error Handling > should throw and log if GeminiChat creation fails 3ms\n× AgentExecutor > Edge Cases and Error Handling > should handle a failed tool call and feed the error to the model 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Termination Conditions) > should terminate when max_turns is reached 1ms\n→ Unsupported chat object type\n× AgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a model call takes too long 2ms\n→ expected \"spy\" to be called 2 times, but got 0 times\n× AgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a tool call takes too long 1ms\n→ Unsupported chat object type\n× AgentExecutor > run (Termination Conditions) > should terminate when AbortSignal is triggered 1ms\n→ Unsupported chat object type\n× AgentExecutor > run (Recovery Turns) > should recover successfully if complete_task is called during the grace turn after MAX_TURNS 1ms\n→ Unsupported chat object type\n× AgentExecutor > run (Recovery Turns) > should fail if complete_task is NOT called during the grace turn after MAX_TURNS 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Recovery Turns) > should recover successfully from a protocol violation (no complete_task) 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Recovery Turns) > should fail recovery from a protocol violation if it violates again 2ms\n→ Unsupported chat object type\n× AgentExecutor > run (Recovery Turns) > should recover successfully from a TIMEOUT 2ms\n→ expected \"spy\" to be called 2 times, but got 0 times\n× AgentExecutor > run (Recovery Turns) > should fail recovery from a TIMEOUT if the grace period also times out 1ms\n→ expected \"spy\" to be called 2 times, but got 0 times\n× AgentExecutor > Telemetry and Logging > should log a RecoveryAttemptEvent when a recoverable error occurs and recovery fails 1ms\n→ Unsupported chat object type\n× AgentExecutor > Telemetry and Logging > should log a successful RecoveryAttemptEvent when recovery succeeds 2ms\n→ Unsupported chat object type\n× AgentExecutor > Chat Compression > should attempt to compress chat history on each turn 2ms\n→ Unsupported chat object type\n× AgentExecutor > Chat Compression > should update chat history when compression is successful 2ms\n→ Unsupported chat object type\n× AgentExecutor > Chat Compression > should pass hasFailedCompressionAttempt=true to compression after a failure 2ms\n→ Unsupported chat object type\n× AgentExecutor > Chat Compression > should reset hasFailedCompressionAttempt flag after a successful compression 2ms\n→ Unsupported chat object type\n✓ src/core/contentGenerator.test.ts (12 tests) 9ms\n✓ src/tools/memoryTool.test.ts (19 tests) 37ms\n✓ src/telemetry/clearcut-logger/clearcut-logger.test.ts (39 tests) 197ms\n✓ src/ide/ide-client.test.ts (35 tests) 44ms\n✓ src/utils/editor.test.ts (122 tests) 21ms\n✓ src/core/baseLlmClient.test.ts (20 tests) 23ms\n✓ src/utils/retry.test.ts (24 tests) 75ms\n✓ src/tools/message-bus-integration.test.ts (9 tests) 65ms\n✓ src/telemetry/memory-monitor.test.ts (31 tests) 25ms\n✓ src/code_assist/server.test.ts (13 tests) 22ms\n✓ src/utils/shell-utils.test.ts (77 tests | 2 skipped) 70ms\n✓ src/mcp/sa-impersonation-provider.test.ts (8 tests) 13ms\n✓ src/code_assist/oauth-credential-storage.test.ts (16 tests) 17ms\n✓ src/core/prompts.test.ts (39 tests) 18ms\n✓ src/utils/llm-edit-fixer.test.ts (8 tests) 66ms\n✓ src/hooks/types.test.ts (35 tests) 6ms\n✓ src/core/geminiChat.test.ts (45 tests) 6594ms\n✓ GeminiChat > sendMessageStream > should fail if the stream ends with an empty part and has no finishReason 504ms\n✓ GeminiChat > sendMessageStream > should throw an error when a tool call is followed by an empty stream response 506ms\n✓ GeminiChat > sendMessageStream > should throw InvalidStreamError when no tool call and no finish reason 503ms\n✓ GeminiChat > sendMessageStream > should throw InvalidStreamError when no tool call and empty response text 505ms\n✓ GeminiChat > sendMessageStream > should throw InvalidStreamError when finishReason is MALFORMED_FUNCTION_CALL 503ms\n✓ GeminiChat > sendMessageStream > should retry when finishReason is MALFORMED_FUNCTION_CALL 503ms\n✓ GeminiChat > sendMessageStream with retries > should yield a RETRY event when an invalid stream is encountered 503ms\n✓ GeminiChat > sendMessageStream with retries > should retry on invalid content, succeed, and report metrics 503ms\n✓ GeminiChat > sendMessageStream with retries > should set temperature to 1 on retry 504ms\n✓ GeminiChat > sendMessageStream with retries > should fail after all retries on persistent invalid content and report metrics 502ms\n✓ GeminiChat > should correctly retry and append to an existing history mid-conversation 502ms\n✓ GeminiChat > should retry if the model returns a completely empty stream (no chunks) 503ms\n✓ GeminiChat > should discard valid partial content from a failed attempt upon retry 504ms\n✓ src/utils/nextSpeakerChecker.test.ts (10 tests) 11ms\n✓ src/hooks/hookRegistry.test.ts (17 tests) 18ms\n✓ src/utils/channel.test.ts (22 tests) 6ms\n✓ src/utils/geminiIgnoreParser.test.ts (2 tests) 38ms\n✓ src/routing/strategies/compositeStrategy.test.ts (6 tests) 6ms\n✓ src/utils/events.test.ts (9 tests) 22ms\n✓ src/utils/delay.test.ts (7 tests) 22ms\n✓ src/services/chatRecordingService.test.ts (10 tests) 8ms\n✓ src/tools/tool-registry.test.ts (14 tests) 36ms\n✓ src/utils/pathCorrector.test.ts (4 tests) 15ms\n✓ src/utils/ignorePatterns.test.ts (28 tests) 8ms\n✓ src/utils/systemEncoding.test.ts (38 tests) 12ms\n✓ src/tools/diffOptions.test.ts (9 tests) 3ms\n✓ src/mcp/oauth-utils.test.ts (29 tests) 18ms\n✓ src/utils/paths.test.ts (88 tests | 17 skipped) 7ms\n✓ src/mcp/google-auth-provider.test.ts (10 tests) 9ms\n✓ src/mcp/oauth-token-storage.test.ts (28 tests) 10ms\n✓ src/confirmation-bus/message-bus.test.ts (10 tests) 10ms\n✓ src/ide/ide-installer.test.ts (15 tests) 10ms\n✓ src/agents/subagent-tool-wrapper.test.ts (7 tests) 28ms\n✓ src/ide/ideContext.test.ts (23 tests) 8ms\n✓ src/code_assist/converter.test.ts (24 tests) 7ms\n✓ src/hooks/hookPlanner.test.ts (9 tests) 5ms\n✓ src/policy/policy-engine.test.ts (46 tests) 38ms\n✓ src/hooks/hookAggregator.test.ts (10 tests) 4ms\n✓ src/routing/modelRouterService.test.ts (10 tests) 54ms\n✓ src/telemetry/high-water-mark-tracker.test.ts (18 tests) 17ms\n✓ src/telemetry/uiTelemetry.test.ts (19 tests) 7ms\n✓ src/code_assist/setup.test.ts (7 tests) 17ms\n✓ src/core/fakeContentGenerator.test.ts (7 tests) 4ms\n✓ src/core/turn.test.ts (21 tests) 9ms\n✓ src/safety/checker-runner.test.ts (9 tests) 11ms\n✓ src/policy/toml-loader.test.ts (25 tests) 152ms\n✓ src/core/loggingContentGenerator.test.ts (7 tests) 34ms\n✓ src/output/stream-json-formatter.test.ts (19 tests) 9ms\n✓ src/utils/summarizer.test.ts (8 tests) 81ms\n✓ src/telemetry/activity-monitor.test.ts (22 tests) 9ms\n✓ src/utils/extensionLoader.test.ts (9 tests | 1 skipped) 6ms\n✓ src/telemetry/rate-limiter.test.ts (24 tests) 15ms\n✓ src/safety/built-in.test.ts (14 tests) 150ms\n✓ src/mcp/token-storage/hybrid-token-storage.test.ts (11 tests) 30ms\n✓ src/telemetry/semantic.test.ts (21 tests) 5ms\n✓ src/telemetry/telemetry.test.ts (2 tests) 24ms\n✓ src/services/modelConfig.integration.test.ts (9 tests) 4ms\n✓ src/utils/filesearch/crawlCache.test.ts (9 tests) 7ms\n✓ src/utils/secure-browser-launcher.test.ts (14 tests) 22ms\n✓ src/services/fileSystemService.test.ts (3 tests) 6ms\n✓ src/ide/process-utils.test.ts (8 tests) 4ms\n✓ src/utils/partUtils.test.ts (37 tests) 10ms\n✓ src/utils/installationManager.test.ts (4 tests) 23ms\n✓ src/code_assist/experiments/client_metadata.test.ts (13 tests) 40ms\n✓ src/utils/generateContentResponseUtilities.test.ts (29 tests) 7ms\n✓ src/code_assist/experiments/experiments.test.ts (4 tests) 12ms\n✓ src/core/nonInteractiveToolExecutor.test.ts (8 tests) 10ms\n✓ src/fallback/handler.test.ts (17 tests) 7ms\n✓ src/tools/tools.test.ts (11 tests) 4ms\n✓ src/utils/debugLogger.test.ts (6 tests) 6ms\n✓ src/utils/googleErrors.test.ts (13 tests) 5ms\n✓ src/agents/schema-utils.test.ts (6 tests) 4ms\n✓ src/telemetry/activity-detector.test.ts (13 tests) 6ms\n✓ src/output/json-formatter.test.ts (15 tests) 5ms\n✓ src/tools/base-tool-invocation.test.ts (2 tests) 8ms\n✓ src/config/models.test.ts (23 tests) 2ms\n✓ src/ide/detect-ide.test.ts (15 tests) 5ms\n✓ src/core/recordingContentGenerator.test.ts (4 tests) 3ms\n✓ src/hooks/hookTranslator.test.ts (10 tests) 12ms\n✓ src/prompts/prompt-registry.test.ts (7 tests) 11ms\n✓ src/routing/strategies/fallbackStrategy.test.ts (4 tests) 2ms\n✓ src/services/modelConfig.golden.test.ts (1 test) 3ms\n✓ src/config/storage.test.ts (6 tests) 4ms\n✓ src/agents/utils.test.ts (12 tests) 4ms\n✓ src/utils/errorParsing.test.ts (10 tests) 4ms\n✓ src/core/apiKeyCredentialStorage.test.ts (7 tests) 9ms\n✓ src/safety/context-builder.test.ts (3 tests) 3ms\n✓ src/prompts/mcp-prompts.test.ts (2 tests) 3ms\n✓ src/agents/codebase-investigator.test.ts (2 tests) 2ms\n✓ src/telemetry/config.test.ts (11 tests) 3ms\n✓ src/telemetry/telemetry-utils.test.ts (6 tests) 2ms\n✓ src/safety/registry.test.ts (4 tests) 2ms\n✓ src/code_assist/codeAssist.test.ts (7 tests) 9ms\n✓ src/utils/googleQuotaErrors.test.ts (15 tests) 6ms\n✓ src/utils/formatters.test.ts (4 tests) 2ms\n✓ src/utils/thoughtUtils.test.ts (11 tests) 2ms\n✓ src/mcp/token-storage/base-token-storage.test.ts (12 tests) 7ms\n✓ src/core/tokenLimits.test.ts (5 tests) 4ms\n✓ src/commands/extensions.test.ts (1 test) 2ms\n✓ src/utils/textUtils.test.ts (12 tests) 4ms\n✓ src/utils/safeJsonStringify.test.ts (8 tests) 2ms\n✓ src/utils/filesearch/result-cache.test.ts (3 tests) 3ms\n✓ src/routing/strategies/defaultStrategy.test.ts (1 test) 3ms\n✓ src/routing/strategies/overrideStrategy.test.ts (3 tests) 9ms\n✓ src/services/chatCompressionService.test.ts (15 tests) 6ms\n✓ src/index.test.ts (1 test) 2ms\n✓ src/agents/registry.test.ts (12 tests) 6ms\n✓ src/utils/flashFallback.test.ts (4 tests) 7ms\n✓ src/tools/mcp-client-manager.test.ts (10 tests) 9ms\n✓ src/config/flashFallback.test.ts (6 tests) 3ms\n✓ src/utils/tool-utils.test.ts (8 tests) 2ms\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 40 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > create (Initialization and Validation) > should correctly apply templates to initialMessages\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:358:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task with output (Happy Path with Output)\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:458:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task without output (Happy Path No Output)\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:605:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should error immediately if the model stops tools without calling complete_task (Protocol Violation)\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:678:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should report an error if complete_task is called with missing required arguments\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:734:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should handle multiple calls to complete_task in the same turn (accept first, block rest)\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:785:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > should execute parallel tool calls and then complete\nError: Test timed out in 5000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\n❯ src/agents/executor.test.ts:806:5\n804| });\n805|\n806| it('should execute parallel tool calls and then complete', async () => {\n| ^\n807| const definition = createTestDefinition([LS_TOOL_NAME]);\n808| const executor = await AgentExecutor.create(\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Execution Loop and Logic) > SECURITY: should block unauthorized tools and provide explicit failure to model\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:932:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Edge Cases and Error Handling > should report an error if complete_task output fails schema validation\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1004:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Edge Cases and Error Handling > should handle a failed tool call and feed the error to the model\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1132:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Termination Conditions) > should terminate when max_turns is reached\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1208:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a model call takes too long\nAssertionError: expected \"spy\" to be called 2 times, but got 0 times\n❯ src/agents/executor.test.ts:1249:37\n1247| expect(output.terminate_reason).toBe(AgentTerminateMode.TIMEOUT);\n1248| expect(output.result).toContain('Agent timed out after 0.5 minutes.');\n1249| expect(mockSendMessageStream).toHaveBeenCalledTimes(2);\n| ^\n1250|\n1251| // Verify activity stream reported the timeout\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a tool call takes too long\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1303:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Termination Conditions) > should terminate when AbortSignal is triggered\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1325:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should recover successfully if complete_task is called during the grace turn after MAX_TURNS\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1384:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should fail if complete_task is NOT called during the grace turn after MAX_TURNS\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1423:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should recover successfully from a protocol violation (no complete_task)\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1469:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should fail recovery from a protocol violation if it violates again\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1502:22\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should recover successfully from a TIMEOUT\nAssertionError: expected \"spy\" to be called 2 times, but got 0 times\n❯ src/agents/executor.test.ts:1567:37\n1565| const output = await runPromise;\n1566|\n1567| expect(mockSendMessageStream).toHaveBeenCalledTimes(2); // 1 failed + 1 recovery\n| ^\n1568| expect(output.terminate_reason).toBe(AgentTerminateMode.GOAL);\n1569| expect(output.result).toBe('Recovered from timeout!');\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > run (Recovery Turns) > should fail recovery from a TIMEOUT if the grace period also times out\nAssertionError: expected \"spy\" to be called 2 times, but got 0 times\n❯ src/agents/executor.test.ts:1626:37\n1624| const output = await runPromise;\n1625|\n1626| expect(mockSendMessageStream).toHaveBeenCalledTimes(2);\n| ^\n1627| expect(output.terminate_reason).toBe(AgentTerminateMode.TIMEOUT);\n1628| expect(output.result).toContain('Agent timed out after 0.5 minutes.');\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Telemetry and Logging > should log a RecoveryAttemptEvent when a recoverable error occurs and recovery fails\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1685:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Telemetry and Logging > should log a successful RecoveryAttemptEvent when recovery succeeds\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1719:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Chat Compression > should attempt to compress chat history on each turn\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1784:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Chat Compression > should update chat history when compression is successful\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1817:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Chat Compression > should pass hasFailedCompressionAttempt=true to compression after a failure\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1860:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/40]⎯\nFAIL src/agents/executor.test.ts > AgentExecutor > Chat Compression > should reset hasFailedCompressionAttempt flag after a successful compression\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\n❯ src/agents/executor.test.ts:1915:7\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/40]⎯\nFAIL src/agents/invocation.test.ts > SubagentInvocation > execute > should initialize and run the executor successfully\nAssertionError: expected \"spy\" to be called with arguments: [ 'Subagent starting...\n' ]\nReceived:\n1st spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_START::{\\\"agentName\\\":\\\"MockAgent\\\",\\\"inputs\\\":{\\\"task\\\":\\\"Execute task\\\"}}\",\n]\nNumber of calls: 1\n❯ src/agents/invocation.test.ts:159:28\n157| expect.any(Function),\n158| );\n159| expect(updateOutput).toHaveBeenCalledWith('Subagent starting...\n');\n| ^\n160|\n161| expect(mockExecutorInstance.run).toHaveBeenCalledWith(params, signal);\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/40]⎯\nFAIL src/agents/invocation.test.ts > SubagentInvocation > execute > should stream THOUGHT_CHUNK activities from the executor\nAssertionError: expected \"spy\" to be called with arguments: [ 'Subagent starting...\n' ]\nReceived:\n1st spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_START::{\\\"agentName\\\":\\\"MockAgent\\\",\\\"inputs\\\":{\\\"task\\\":\\\"Execute task\\\"}}\",\n]\n2nd spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_THOUGHT::{\\\"thought\\\":\\\"Analyzing...\\\"}\",\n]\n3rd spy call:\n[\n- \"Subagent starting...\n- \",\n+ \"GEMINI_SUBAGENT_THOUGHT::{\\\"thought\\\":\\\" Still thinking.\\\"}\",\n]\nNumber of calls: 3\n❯ src/agents/invocation.test.ts:197:28\n195| await invocation.execute(signal, updateOutput);\n196|\n197| expect(updateOutput).toHaveBeenCalledWith('Subagent starting...\n');\n| ^\n198| expect(updateOutput).toHaveBeenCalledWith('🤖💭 Analyzing...');\n199| expect(updateOutput).toHaveBeenCalledWith('🤖💭 Still thinking.');\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/40]⎯\nFAIL src/agents/invocation.test.ts > SubagentInvocation > execute > should NOT stream other activities (e.g., TOOL_CALL_START, ERROR)\nAssertionError: expected \"spy\" to be called 1 times, but got 3 times\n❯ src/agents/invocation.test.ts:227:28\n225|\n226| // Should only contain the initial \"Subagent starting...\" message\n227| expect(updateOutput).toHaveBeenCalledTimes(1);\n| ^\n228| expect(updateOutput).toHaveBeenCalledWith('Subagent starting...\n');\n229| });\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/40]⎯\nFAIL src/tools/shell.test.ts > ShellTool > execute > should summarize output when configured\nAssertionError: expected \"summarizeToolOutput\" to be called with arguments: [ { …(11) }, …(4) ]\nNumber of calls: 0\n❯ src/tools/shell.test.ts:368:46\n366| const result = await promise;\n367|\n368| expect(summarizer.summarizeToolOutput).toHaveBeenCalledWith(\n| ^\n369| mockConfig,\n370| { model: 'summarizer-shell' },\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[30/40]⎯\nFAIL src/utils/environmentContext.test.ts > getDirectoryContextString > should return context string for a single directory\nAssertionError: expected 'I\\'m currently working in the directo…' to contain 'Here is the folder structure of the c…'\n- Expected\n+ Received\n- Here is the folder structure of the current working directories:\n-\n- Mock Folder Structure\n+ I'm currently working in the directory: /test/dir. I have access to this directory and its subdirectories.\n+\n❯ src/utils/environmentContext.test.ts:55:27\n53| \"I'm currently working in the directory: /test/dir\",\n54| );\n55| expect(contextString).toContain(\n| ^\n56| 'Here is the folder structure of the current working directories:\nMock Folder Structure',\n57| );\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[31/40]⎯\nFAIL src/utils/environmentContext.test.ts > getDirectoryContextString > should return context string for multiple directories\nAssertionError: expected 'I\\'m currently working in the followi…' to contain 'Here is the folder structure of the c…'\n- Expected\n+ Received\n- Here is the folder structure of the current working directories:\n-\n- Structure 1\n- Structure 2\n+ I'm currently working in the following directories:\n+ - /test/dir1\n+ - /test/dir2. I have access to these directories and their subdirectories.\n+\n❯ src/utils/environmentContext.test.ts:72:27\n70| \"I'm currently working in the following directories:\n- /test/dir1\n- /test/dir2\",\n71| );\n72| expect(contextString).toContain(\n| ^\n73| 'Here is the folder structure of the current working directories:\nStructure 1\nStructure 2',\n74| );\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[32/40]⎯\nFAIL src/utils/environmentContext.test.ts > getEnvironmentContext > should return basic environment context for a single directory\nAssertionError: expected 'This is the Gemini CLI. We are settin…' to contain 'Here is the folder structure of the c…'\n- Expected\n+ Received\n- Here is the folder structure of the current working directories:\n-\n- Mock Folder Structure\n+ This is the Gemini CLI. We are setting up the context for our chat.\n+ Today's date is Tuesday, August 5, 2025 (formatted according to the user's locale).\n+ My operating system is: darwin\n+ The project's temporary directory is: /tmp/project-temp\n+ I'm currently working in the directory: /test/dir. I have access to this directory and its subdirectories.\n❯ src/utils/environmentContext.test.ts:122:21\n120| \"I'm currently working in the directory: /test/dir\",\n121| );\n122| expect(context).toContain(\n| ^\n123| 'Here is the folder structure of the current working directories:\nMock Folder Structure',\n124| );\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[33/40]⎯\nFAIL src/utils/environmentContext.test.ts > getEnvironmentContext > should return basic environment context for multiple directories\nAssertionError: expected 'This is the Gemini CLI. We are settin…' to contain 'Here is the folder structure of the c…'\n- Expected\n+ Received\n- Here is the folder structure of the current working directories:\n-\n- Structure 1\n- Structure 2\n+ This is the Gemini CLI. We are setting up the context for our chat.\n+ Today's date is Tuesday, August 5, 2025 (formatted according to the user's locale).\n+ My operating system is: darwin\n+ The project's temporary directory is: /tmp/project-temp\n+ I'm currently working in the following directories:\n+ - /test/dir1\n+ - /test/dir2. I have access to these directories and their subdirectories.\n❯ src/utils/environmentContext.test.ts:146:21\n144| \"I'm currently working in the following directories:\n- /test/dir1\n- /test/dir2\",\n145| );\n146| expect(context).toContain(\n| ^\n147| 'Here is the folder structure of the current working directories:\nStructure 1\nStructure 2',\n148| );\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[34/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should call generateJson with the correct parameters\nAssertionError: expected \"spy\" to be called with arguments: [ ObjectContaining{…} ]\nNumber of calls: 0\n❯ src/routing/strategies/classifierStrategy.test.ts:72:44\n70| await strategy.route(mockContext, mockConfig, mockBaseLlmClient);\n71|\n72| expect(mockBaseLlmClient.generateJson).toHaveBeenCalledWith(\n| ^\n73| expect.objectContaining({\n74| modelConfigKey: { model: mockResolvedConfig.model },\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[35/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should route to FLASH model for a simple task\nAssertionError: expected \"spy\" to be called once, but got 0 times\n❯ src/routing/strategies/classifierStrategy.test.ts:95:44\n93| );\n94|\n95| expect(mockBaseLlmClient.generateJson).toHaveBeenCalledOnce();\n| ^\n96| expect(decision).toEqual({\n97| model: DEFAULT_GEMINI_FLASH_MODEL,\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[36/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should route to PRO model for a complex task\nAssertionError: expected \"spy\" to be called once, but got 0 times\n❯ src/routing/strategies/classifierStrategy.test.ts:122:44\n120| );\n121|\n122| expect(mockBaseLlmClient.generateJson).toHaveBeenCalledOnce();\n| ^\n123| expect(decision).toEqual({\n124| model: DEFAULT_GEMINI_MODEL,\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[37/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should filter out tool-related history before sending to classifier\nTypeError: Cannot read properties of undefined (reading '0')\n❯ src/routing/strategies/classifierStrategy.test.ts:197:15\n195|\n196| const generateJsonCall = vi.mocked(mockBaseLlmClient.generateJson).mock\n197| .calls[0][0];\n| ^\n198| const contents = generateJsonCall.contents;\n199|\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[38/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should respect HISTORY_SEARCH_WINDOW and HISTORY_TURNS_FOR_CONTEXT\nTypeError: Cannot read properties of undefined (reading '0')\n❯ src/routing/strategies/classifierStrategy.test.ts:233:15\n231|\n232| const generateJsonCall = vi.mocked(mockBaseLlmClient.generateJson).mock\n233| .calls[0][0];\n| ^\n234| const contents = generateJsonCall.contents;\n235|\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[39/40]⎯\nFAIL src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should use a fallback promptId if not found in context\nTypeError: Cannot read properties of undefined (reading '0')\n❯ src/routing/strategies/classifierStrategy.test.ts:269:15\n267|\n268| const generateJsonCall = vi.mocked(mockBaseLlmClient.generateJson).mock\n269| .calls[0][0];\n| ^\n270|\n271| expect(generateJsonCall.promptId).toMatch(\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[40/40]⎯\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Errors ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nVitest caught 1 unhandled error during the test run.\nThis might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nError: Unsupported chat object type\n❯ AgentExecutor.callModel src/agents/executor.ts:639:13\n637| return this.callOllamaModel(chat, message, tools, signal, promptId);\n638| } else {\n639| throw new Error('Unsupported chat object type');\n| ^\n640| }\n641| }\n❯ src/agents/executor.ts:214:14\n❯ Object.<anonymous> src/agents/executor.test.ts:230:63\n❯ Object.mockCall ../../node_modules/@vitest/spy/dist/index.js:96:15\n❯ Object.spy ../../node_modules/tinyspy/dist/index.js:47:80\n❯ AgentExecutor.executeTurn src/agents/executor.ts:211:67\n❯ AgentExecutor.run src/agents/executor.ts:450:39\nThis error originated in \"src/agents/executor.test.ts\" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.\nThe latest test that might've caused the error is \"should execute parallel tool calls and then complete\". It might mean one of the following:\n- The error was thrown, while Vitest was running this test.\n- If the error occurred after the test had been completed, this was the last documented test before it was thrown.\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nTest Files 5 failed | 165 passed (170)\nTests 40 failed | 3235 passed | 24 skipped (3299)\nErrors 1 error\nStart at 14:51:16\nDuration 16.70s (transform 5.10s, setup 687ms, collect 94.03s, tests 29.46s, environment 25ms, prepare 11.14s)\nJUNIT report written to /Users/siddharthdiwan/Desktop/gemini-cli-gemma/packages/core/junit.xml\nnpm error Lifecycle script `test` failed with error:\nnpm error code 1\nnpm error path /Users/siddharthdiwan/Desktop/gemini-cli-gemma/packages/core\nnpm error workspace @google/gemini-cli-core@0.17.0-nightly.20251116.e650a4ee5\nnpm error location /Users/siddharthdiwan/Desktop/gemini-cli-gemma/packages/core\nnpm error command failed\nnpm error command sh -c vitest run\n> gemini-cli-vscode-ide-companion@0.17.0-nightly.20251116.e650a4ee5 test\n> vitest run\nRUN v3.2.4 /Users/siddharthdiwan/Desktop/gemini-cli-gemma/packages/vscode-ide-companion\n✓ src/open-files-manager.test.ts (17 tests) 13ms\n✓ src/ide-server.test.ts (13 tests | 1 skipped) 68ms\n✓ src/extension.test.ts (11 tests) 45ms\nTest Files 3 passed (3)\nTests 40 passed | 1 skipped (41)\nStart at 14:51:33\nDuration 504ms (transform 216ms, setup 0ms, collect 584ms, tests 126ms, environment 0ms, prepare 162ms)\nError: (none)\nExit Code: 1\nSignal: 0\nBackground PIDs: (none)\nProcess Group PGID: 54740"}}Remember to follow the formats below to respond depending on which stage you are in:
Example for **STAGE 1** (gathering information):
I am in **STAGE 1**. I need to [Your concise rationale and what you are trying to do and why it will help].
```json
{
  "name": "read_file",
  "parameters": { ... }
}
```

Example for **STAGE 2** (executing build/test command):
I am in **STAGE 2** I need to [Your concise rationale and what you are trying to do and why it will help].
```json
{
  "name": "run_shell_command",
  "parameters": { ... }
}
```

Example for **STAGE 3** (analyzing output):
I am in **STAGE 3**. Here are the execution highlights:
- [Your concise highlights go here].
- [Your concise highlights go here].
- [Your concise highlights go here].
- [Your concise highlights go here].
- [Your concise highlights go here].
```json
{
  "name": "complete_task"
}
```
